<!DOCTYPE html>
<html>
  
  <head>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="bower_components/socket.io-client/socket.io.js"></script>
    <script src="bower_components/Chart.js/Chart.min.js"></script>
    <script>
      count = 0;
       var socket = io.connect(window.location.host.split(":")[0]+':3000');  // take the IP address of the machine, assuming socket server is on the same machine.
       socket.on('sensors', function (data) { //append sensors to table
      
       	data.forEach(function (d) {
       	var html = '<tr class=sensore ><td>' + d + '</td><td id="' + d + '"></td></tr>';
       		$('#temps').append(html);
       	});
       });
      
       //update corresponding row with sensor value
       socket.on('temps', function (data) {
           count=count+1;
      
       	$('#' + data.id).html(data.value);
           if((count%4)==0){updateChart(data.value);}
       });
      
      socket.on('disconnect', function () {
        $( ".sensore" ).remove();
        alert('Socket is disconnected.');
      
      });
    </script>
  </head>
  
  <body>
    <h1>TEST</h1>
    <div class="container">
      <table class="table" id="temps">
        <thead>
          <tr>
            <th>Sensor ID</th>
            <th>Temperature (celsius)</th>
          </tr>
        </thead>
      </table>
    </div>
    <div style="text-align: center;">
      <canvas id="updating-chart" width="500" height="300"></canvas>
  </body>
  <script>
    var arr=(function(a,b){while(a--)b[a]=a;return b})(25,[]);
    var canvas = document.getElementById('updating-chart'),
        ctx = canvas.getContext('2d'),
        startingData = {
          labels: arr,
          datasets: [
              {
                fillColor: "rgba(151,187,205,0.2)",
                  strokeColor: "rgba(151,187,205,1)",
                  pointColor: "rgba(151,187,205,1)",
                  pointStrokeColor: "#fff",
                  data: arr
              }
          ]
        },
        latestLabel = startingData.labels[6];
    
    // Reduce the animation steps for demo clarity.
    
    var myLiveChart = new Chart(ctx).Line(startingData, {
            animationSteps: 10,
            scaleOverride : true,
            scaleSteps : 10,
            scaleStepWidth : 12,
            scaleStartValue : 0 });
    
    
    function updateChart(value){
      // Add two random numbers for each dataset
      myLiveChart.addData([value], ++latestLabel);
      // Remove the first point so we dont just add values forever
      myLiveChart.removeData();
    };
  </script>
</html>